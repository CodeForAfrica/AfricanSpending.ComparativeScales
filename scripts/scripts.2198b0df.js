"use strict";angular.module("comparativescalesApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ngFileUpload","ui.select"]).config(["$routeProvider",function(a){a.when("/create",{templateUrl:"views/create.html",controller:"CreateCtrl",resolve:{currencies:["apiservice",function(a){return a.getCurrenciesList()}],rates:["apiservice",function(a){return a.getCurrenciesRates()}],editorpicks:["apiservice",function(a){return a.getFile("data/editorpicks/data.json")}]}}).when("/embed",{templateUrl:"views/embed.html",controller:"EmbedCtrl",resolve:{config:["apiservice","$location",function(a,b){var c=b.search();return a.getGistFile(c.id,c.version,"config.json")}]}}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).otherwise({redirectTo:"/home"})}]),angular.module("comparativescalesApp").controller("CreateCtrl",["$scope","$timeout","$http","$location","$uibModal","$log","Upload","currencies","rates","editorpicks",function(a,b,c,d,e,f,g,h,i,j){a.viewModel="input",a.editorpicks=j,a.editorpicks.forEach(function(a){a.isEditorpick=!0}),a.rates=i,a.currencies=h,a.bignumber,a.description,a.units=d3.keys(a.currencies),a.selUnit={selected:"USD"},a.comparisons=[],a.objDescription,a.objvalue,a.source,a.showImageButton=!0,a.icon,a.selectedComparisons=[],a.boxwidth=600,a.boxheight=300,a.iframeheight=600,a.gistId,a.gistVersion,a.embedCode,a.baseUrl=d.absUrl().replace("#"+d.path(),"#")+"/embed?",a.outButtonDisabled=!0,a.addButtonDisabled=!0,a.credits,a.savinggist=!1,a.fontsList=[{label:"Montserrat/Open Sans",slug:"moop"},{label:"Font1/Font2",slug:"tica"}],a.selectedFonts=a.fontsList[0].slug,a.iconsSize=["small","medium","large"],a.iconSize=a.iconsSize[1],a.iconsStyle=["light","dark"],a.iconStyle=a.iconsStyle[0],a.layouts=["tabs","columns"],a.layout=a.layouts[0],a.addComparison=function(b){if(!b.id){var c=a.comparisons.length?a.comparisons.length+1:1;b.id=c,a.comparisons.push(b)}},a.saveComparison=function(b){var c=a.comparisons.filter(function(a){return a.id==b});c.length?c[0].isActive=!1:console.warn("No comparison found!"),a.editMode=!1},a.removeComparison=function(b){var c=a.comparisons.map(function(a){return a.id});a.comparisons.splice(c.indexOf(b),1),a.selectedComparisons.splice(a.selectedComparisons.indexOf(b),1)},a.modComparisons=function(b,c){b?(a.comparisons.filter(function(a){return a.id==c})[0].isSelected=!0,a.selectedComparisons.push(c)):(a.selectedComparisons.splice(a.selectedComparisons.indexOf(c),1),a.comparisons.filter(function(a){return a.id==c})[0].isSelected=!1)},a.modEditorpicks=function(b,c){b?(a.editorpicks.filter(function(a){return a.id==c})[0].isSelected=!0,a.selectedComparisons.push(c)):(a.selectedComparisons.splice(a.selectedComparisons.indexOf(c),1),a.editorpicks.filter(function(a){return a.id==c})[0].isSelected=!1)},a.backtoedit=function(){a.viewModel="input",a.gistId=null},a.open=function(b){var c=e.open({templateUrl:"views/addicon.html",controller:"IconmodalCtrl",size:"lg",resolve:{comparison:function(){return b},bignumber:function(){return a.bignumber},selUnit:function(){return a.selUnit.selected}}});c.result.then(function(b){a.addComparison(b)},function(){f.info("Modal dismissed at: "+new Date)})},a.$watch("icon",function(b,c){b!=c&&b&&a.upload([a.icon])}),a.$watch("[boxwidth, boxheight, iframeheight, layout, iconStyle, iconSize, selectedFonts, gistId, gistVersion]",function(b,c){b[0]&&b[1]&&b[2]&&b[3]&&b[4]&&(a.embedCode='<iframe src="'+a.baseUrl+"&boxheight="+b[1]+"&height="+b[2]+"&layout="+b[3]+"&style="+b[4]+"&size="+b[5]+"&fonts="+b[6]+"&id="+b[7]+"&version="+b[8]+'" width="'+b[0]+'" height="'+b[2]+'" frameborder="0"></iframe>')}),a.getNumber=function(a,b){return b?new Array(Math.round(b)):a?new Array(Math.round(a)):void 0},a.limit=100,a.increaseLimit=function(){a.limit+=100},a.upload=function(c,d){if(c&&c.length)for(var e=0;e<c.length;e++){var f=c[e],g=new FileReader;g.onload=function(c){var e=g.result;b(function(){var b=a.comparisons.filter(function(a){return a.id==d});b.length?b[0].icon=e:console.warn("No comparison found!")})},g.readAsText(f)}},a.publishGist=function(){var b=a.comparisons.concat(a.editorpicks).filter(function(a){return a.isSelected}).map(function(b){var c={objDescription:b.objDescription,source:b.source,credits:b.credits,itemsNumber:Math.ceil(a.bignumber/b.objvalue),id:b.id,icon:b.icon};return c}),d="USD"!=a.selUnit?{rate:i.rates[a.selUnit.selected],date:i.timestamp}:null,e={bignumber:a.bignumber,description:a.description,selUnit:a.selUnit.selected,changeRate:d,comparisons:b},f={description:a.description,"public":!0,files:{"config.json":{content:JSON.stringify(e)}}};f=JSON.stringify(f),a.savinggist=!0,c.post("https://api.github.com/gists",f).then(function(b){a.gistId=b.data.id,a.gistVersion=b.data.history[0].version,a.savinggist=!1},function(b){a.savinggist=!1})}}]),angular.module("comparativescalesApp").controller("EmbedCtrl",["$scope","config","$location",function(a,b,c){a.config=b,console.log(a.config.selUnit),a.params=c.search(),a.boxheight=a.params.boxheight,a.iconSize=a.params.size,a.getNumber=function(a,b){return b?new Array(b):a?new Array(Math.round(a)):void 0}}]),angular.module("comparativescalesApp").controller("ViewmenuCtrl",["$scope",function(a){a.viewModel="input"}]),angular.module("comparativescalesApp").directive("svgIcon",["apiservice",function(a){return{restrict:"A",scope:{comparison:"="},link:function(b,c,d){var e,f=d3.select(c[0]);d.index;if(b.comparison.isEditorpick&&!b.comparison.icon)a.getFile(b.comparison.iconUrl).then(function(a){b.comparison.icon=a},function(a){console.warn("there was a problem in loding the icon")});else if(b.comparison.icon){f.empty(),f.html(b.comparison.icon),e=f.select("svg"),e.attr("width","100%").attr("height","100%");var g="",h=e.selectAll("text").each(function(a,b){g=g+(b?" ":"")+d3.select(this).text()});b.comparison.credits=g?g:b.comparison.credits,h.remove()}b.$watch(function(a){return a.comparison.icon},function(a,c){if(a!=c&&a){b.showImageButton=!1,f.empty(),f.html(a),e=f.select("svg"),e.attr("width","100%").attr("height","100%");var d="",g=e.selectAll("text").each(function(a,b){d=d+(b?" ":"")+d3.select(this).text()});b.comparison.credits=d?d:b.comparison.credits,g.remove()}})}}}]),angular.module("comparativescalesApp").factory("apiservice",["$q","$http",function(a,b){var c="https://api.github.com/gists/",d="https://gist.githubusercontent.com/anonymous/";return{getGist:function(d){var e=a.defer();return b({method:"GET",url:c+d}).success(function(a){e.resolve(a)}).error(function(){e.reject("An error occured while fetching gist")}),e.promise},getGistFile:function(c,e,f){var g=a.defer();return b({method:"GET",url:d+c+"/raw/"+e+"/"+f}).success(function(a){g.resolve(a)}).error(function(){g.reject("An error occured while fetching gist")}),g.promise},getCurrenciesList:function(){var c=a.defer();return b({method:"GET",url:"https://openexchangerates.org/api/currencies.json"}).success(function(a){c.resolve(a)}).error(function(){c.reject("An error occured while fetching currencies")}),c.promise},getCurrenciesRates:function(){var c=a.defer();return b({method:"GET",url:"data/rates.json"}).success(function(a){c.resolve(a)}).error(function(){c.reject("An error occured while fetching currencies rates")}),c.promise},getFile:function(c){var d=a.defer();return b({method:"GET",url:c}).success(function(a){d.resolve(a)}).error(function(){d.reject("An error occured while fetching file")}),d.promise}}}]),angular.module("ui.checkbox",[]).directive("checkbox",function(){return{scope:{},require:"ngModel",restrict:"E",replace:"true",template:"<button type=\"button\" ng-style=\"stylebtn\" class=\"btn btn-default\" ng-class=\"{'btn-xs': size==='default', 'btn-sm': size==='large', 'btn-lg': size==='largest', 'checked': checked===true}\">"+'<span ng-style="styleicon" class="glyphicon" ng-class="{\'glyphicon-ok\': checked===true}"></span></button>',link:function(a,b,c,d){a.size="default",a.stylebtn={},a.styleicon={width:"10px",left:"-1px"},void 0!==c.large&&(a.size="large",a.stylebtn={"padding-top":"2px","padding-bottom":"2px",height:"30px"},a.styleicon={width:"8px",left:"-5px","font-size":"17px"}),void 0!==c.larger&&(a.size="larger",a.stylebtn={"padding-top":"2px","padding-bottom":"2px",height:"34px"},a.styleicon={width:"8px",left:"-8px","font-size":"22px"}),void 0!==c.largest&&(a.size="largest",a.stylebtn={"padding-top":"2px","padding-bottom":"2px",height:"45px"},a.styleicon={width:"11px",left:"-11px","font-size":"30px"});var e=!0,f=!1;void 0!==c.ngTrueValue&&(e=c.ngTrueValue),void 0!==c.ngFalseValue&&(f=c.ngFalseValue),void 0!==a.name&&(b.name=a.name),a.$watch(function(){return d.$modelValue===e||d.$modelValue===!0?d.$setViewValue(e):d.$setViewValue(f),d.$modelValue},function(b,c){a.checked=d.$modelValue===e},!0),b.bind("click",function(){a.$apply(function(){d.$modelValue===f?d.$setViewValue(e):d.$setViewValue(f)})})}}}),angular.module("comparativescalesApp").controller("IconmodalCtrl",["$scope","$uibModalInstance","$timeout","Upload","comparison","bignumber","selUnit",function(a,b,c,d,e,f,g){a.bignumber=f,a.selUnit=g;var h={objDescription:"",source:"",credits:"",itemsNumber:"",objvalue:"",icon:"",isSelected:!1,isActive:!1};a.comparison=e?e:h,a.ok=function(){b.close(a.comparison)},a.cancel=function(){b.dismiss("cancel")},a.upload=function(b){if(b&&b.length)for(var d=0;d<b.length;d++){var e=b[d],f=new FileReader;f.onload=function(b){var d=f.result;c(function(){a.comparison.icon=d})},f.readAsText(e)}}}]),angular.module("comparativescalesApp").directive("svgIconPreview",function(){return{restrict:"A",link:function(a,b,c){var d,e=d3.select(b[0]);c.index;if(a.comparison.icon){e.empty(),e.html(a.comparison.icon),d=e.select("svg"),d.attr("width","100%").attr("height","100%");var f="",g=d.selectAll("text").each(function(a,b){f=f+(b?" ":"")+d3.select(this).text()});a.comparison.credits=f?f:a.comparison.credits,g.remove()}a.$watch(function(a){return a.comparison.icon},function(b,c){if(b!=c&&b){a.showImageButton=!1,e.empty(),e.html(b),d=e.select("svg"),d.attr("width","100%").attr("height","100%");var f="",g=d.selectAll("text").each(function(a,b){f=f+(b?" ":"")+d3.select(this).text()});a.comparison.credits=f?f:a.comparison.credits,g.remove()}})}}}),angular.module("comparativescalesApp").controller("HomeCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("comparativescalesApp").directive("vtabs",function(){return{templateUrl:"views/vtabs.html",restrict:"A",link:function(a,b,c){a.config?(a.total=a.config.comparisons,a.selUnit={selected:a.config.selUnit}):a.total=a.comparisons.concat(a.editorpicks).filter(function(a){return a.isSelected}),a.tabActive=a.total[0].id,a.tabSwitch=function(b){a.tabActive=b}}}}),angular.module("comparativescalesApp").directive("bufferedScroll",["$parse",function(a){return function(b,c,d){var e=a(d.bufferedScroll);c.scroll(function(a){var d=c[0].scrollTop,f=c[0].scrollHeight,g=c[0].offsetHeight;d===f-g&&b.$apply(function(){e(b)})})}}]);